Steps:

  - Name: GetProjectZones
    Worker: mongoDBConnector
    Job: aggregate_data
    Output: GCPProjectZones
    Params:
      collection_name: GCPProjectZones
      pipeline:
        - $unset:
            - _id
  
  - Name: GetToMongo.ComputeInstances
    Job: get_data_to_mongo
    Input: GCPProjectZones.data
    Output: GCloudComputeInstances
    Params:
      from_worker: gcloudConnector
      model_name: ComputeInstances

  # # CAREFUL WITH THAT AXE, EUGENE : 
  # # many requests will be sent with this one you might blow up your API quota
  # - Name: GetToMongo.MachineTypes
  #   Job: get_data_to_mongo
  #   Input: GCPProjectZones.data
  #   Output: ComputeMachineTypes
  #   Params:
  #     from_worker: gcloudConnector
  #     model_name: ComputeMachineTypes

  - Name: BuildParentURIs
    Worker: mongoDBConnector
    Job: aggregate_data
    Output: GCRParentURIs
    Params:
      collection_name: GCPProjects
      pipeline:
        - $set:
            parent: 
              $replaceOne:
                input: "/projects/{project_id}/location/europe-west-4"
                find: "{project_id}"
                replacement: $project_id
        - $project:
            parent: 1
        - $unset:
            - _id
    
  # - Name: GetToMongo.CloudRunServices
  #   Job: get_data_to_mongo
  #   Input: GCPParentURIs.data
  #   Output: CloudRunServices
  #   Params:
  #     from_worker: gcloudConnector
  #     model_name: CloudRunServices
