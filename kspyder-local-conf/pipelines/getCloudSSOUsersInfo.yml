Steps:

  # - Name: GetToMongo.CloudSSODirectories
  #   Job: get_data_to_mongo
  #   Output: CloudSSODirectories
  #   Params:
  #     from_worker: aliyunCLIConnector
  #     model_name: CloudSSODirectories

  - Name: Extract.CloudSSODirectoryId
    Worker: mongoDBConnector
    Job: aggregate_data
    Output: DirectoryIds
    Params:
      collection_name: CloudSSODirectories
      pipeline:
        - $project:
            directory_id: $DirectoryId
        - $unset:
          - _id

  - Name: GetToMongo.CloudSSOGroups
    Job: get_data_to_mongo
    Input: DirectoryIds.data
    Output: CloudSSOGroups
    DumpJSON: true
    Params:
      from_worker: aliyunConnector
      model_name: CloudSSOGroups

  - Name: GetDirectoryGroupIds
    Worker: mongoDBConnector
    Job: aggregate_data
    Output: DirectoryGroupIds
    Params:
      collection_name: CloudSSOGroups
      pipeline:
        - $project:
            directory_id: 1
            group_id: $GroupId
        - $unset:
            - _id

  - Name: GetToMongo.CloudSSOGroupMembers
    Job: get_data_to_mongo
    Input: DirectoryGroupIds.data
    Output: CloudSSOGroupMembers
    DumpJSON: true
    Params:
      from_worker: aliyunConnector
      model_name: CloudSSOGroupMembers

  - Name: GetToMongo.CloudSSOUsers
    Job: get_data_to_mongo
    Input: DirectoryIds.data
    Output: CloudSSOUsers
    DumpJSON: true
    Params:
      from_worker: aliyunConnector
      model_name: CloudSSOUsers